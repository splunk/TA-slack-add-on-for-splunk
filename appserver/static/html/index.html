<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>

<body>
    <blockquote class="blockquote text-center">
        <p class="mb-0">Access Token Generated</p>
    </blockquote>
    <div class="container-fluid">
        <div id="divform" class="row">
            <form action="https://slack.com/api/oauth.v2.access" method="post" enctype="multipart/form-data"
                name="authform">
                <div class="col">
                    <!-- <label for="access_token">Access Token Generated</label><br> -->
                    <input type="text" id="access_token" class="form-control" value="" name="access_token"
                        style="position:absolute;left:-1000px;top:-1000px;" /><br><br>
                </div>
                <script type="text/javascript">
                    function getCode() {
                        var code = location.href.match(new RegExp("(/\?code=)([^\&]*)"))[2];
                        return code;
                    }
                </script>
                <script type="text/javascript">
                    function getRedirectURI() {
                        var redirect_uri = window.location.href.split('?')[0];
                        return redirect_uri;
                    }
                </script>
                <script>
                    $(document).ready(function () {
                        var request;
                        var response;
                        console.log("Inside ready");
                        // Abort any pending request
                        if (request) {
                            request.abort();
                        }
                        data = { "code": getCode(), "client_id": '1016219254245.1020659582432', "client_secret": '4da55ff716fe500625eef2dcec9d8a7c', "redirect_uri": getRedirectURI() }
                        console.log("Data : ");
                        console.log(data);
                        request = $.ajax({
                            url: "https://slack.com/api/oauth.v2.access",
                            type: "post",
                            data: data,
                            contentType: "application/x-www-form-urlencoded"
                        });
                        // Callback handler that will be called on success
                        request.done(function (response, textStatus, jqXHR) {
                            // Log a message to the console
                            console.log("Hooray, it worked!");
                            var access_token = response['authed_user']['access_token'];
                            console.log("Access Token : " + access_token);
                            console.log("Response : ");
                            console.log(response);
                            $('#access_token').val('');
                            $('#access_token').val(access_token);
                        });
                        // Callback handler that will be called on failure
                        request.fail(function (jqXHR, textStatus, errorThrown) {
                            // Log the error to the console
                            console.error(
                                "The following error occurred: " +
                                textStatus, errorThrown
                            );
                        });
                        // Callback handler that will be called regardless
                        // if the request failed or succeeded
                        request.always(function () {
                            // Reenable the inputs
                            console.log("Always function");
                        });
                    });
                </script>
                <script type="text/javascript">
                    function copyAccessToken() {
                        var access_token_element = document.getElementById("access_token");
                        access_token_element.type = 'text';
                        access_token_element.select();
                        document.execCommand("copy");
                        access_token_element.type = 'hidden';
                    }
                </script>
                <script type="text/javascript">
                    function closePage() {
                        window.self.close();
                    }
                </script>
                <div id="submit_button_div" class="col-sm-10">
                    <button type="button" class="btn btn-primary btn-lg" onclick="copyAccessToken(); closePage();">Click
                        to Copy Access token to paste into your Add-on Settings</button>
                </div>
            </form>
        </div>
    </div>
</body>

</html>